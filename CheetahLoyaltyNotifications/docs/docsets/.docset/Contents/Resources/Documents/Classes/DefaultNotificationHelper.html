<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DefaultNotificationHelper Class Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset='utf-8'>
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
    <script src="../js/lunr.min.js" defer></script>
    <script src="../js/typeahead.jquery.js" defer></script>
    <script src="../js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a name="//apple_ref/swift/Class/DefaultNotificationHelper" class="dashAnchor"></a>
    <a title="DefaultNotificationHelper Class Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="../index.html"> Docs</a></p>
        <p class="header-right"><a href="https://github.com/LoyalSphere/cheetah-loyalty-ios-sdk"><img src="../img/gh.png" alt="GitHub"/>View on GitHub</a></p>
        <div class="header-right">
          <form role="search" action="../search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </div>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="../index.html"> Reference</a>
        <img id="carat" src="../img/carat.png" alt=""/>
        DefaultNotificationHelper Class Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="../Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Classes/DefaultNotificationHelper.html">DefaultNotificationHelper</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/DefaultPushHandler.html">DefaultPushHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/DefaultRichPushHandler.html">DefaultRichPushHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/RichPushService.html">RichPushService</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Enums/NotificationType.html">NotificationType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Enums/RichPushAction.html">RichPushAction</a>
              </li>
              <li class="nav-group-task">
                <a href="../Enums/RichPushCategory.html">RichPushCategory</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Extensions/UNNotificationAttachment.html">UNNotificationAttachment</a>
              </li>
              <li class="nav-group-task">
                <a href="../Extensions/UNUserNotificationCenter.html">UNUserNotificationCenter</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/NotificationHelper.html">NotificationHelper</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/PushHandler.html">PushHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/RichPushHandler.html">RichPushHandler</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>DefaultNotificationHelper</h1>
              <div class="declaration">
                <div class="language">
                  
                  <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">class</span> <span class="kt">DefaultNotificationHelper</span> <span class="p">:</span> <span class="kt"><a href="../Protocols/NotificationHelper.html">NotificationHelper</a></span></code></pre>

                </div>
              </div>
            <p><code><a href="../Protocols/NotificationHelper.html">NotificationHelper</a></code> with default implementations.</p>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC11pushHandlerAA04PushH0_pvp"></a>
                    <a name="//apple_ref/swift/Property/pushHandler" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC11pushHandlerAA04PushH0_pvp">pushHandler</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Handler of Basic (non-rich) Push Notifications</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="k">var</span> <span class="nv">pushHandler</span><span class="p">:</span> <span class="kt"><a href="../Protocols/PushHandler.html">PushHandler</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC15richPushHandlerAA04RichhI0_pvp"></a>
                    <a name="//apple_ref/swift/Property/richPushHandler" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC15richPushHandlerAA04RichhI0_pvp">richPushHandler</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Handler of Rich Push Notification Quick Actions</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="k">var</span> <span class="nv">richPushHandler</span><span class="p">:</span> <span class="kt"><a href="../Protocols/RichPushHandler.html">RichPushHandler</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC8deviceIdSSvp"></a>
                    <a name="//apple_ref/swift/Property/deviceId" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC8deviceIdSSvp">deviceId</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Device ID that will be used when registering the device to the server along with the device token
The default value is <code>Configuration.shared.userAgentName + &quot;-&quot; + UUID().uuidString</code></p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="k">var</span> <span class="nv">deviceId</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC11pushHandler08richPushH0AcA0jH0_p_AA04RichjH0_ptcfc"></a>
                    <a name="//apple_ref/swift/Method/init(pushHandler:richPushHandler:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC11pushHandler08richPushH0AcA0jH0_p_AA04RichjH0_ptcfc">init(pushHandler:<wbr>richPushHandler:<wbr>)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">pushHandler</span><span class="p">:</span> <span class="kt"><a href="../Protocols/PushHandler.html">PushHandler</a></span><span class="p">,</span> <span class="nv">richPushHandler</span><span class="p">:</span> <span class="kt"><a href="../Protocols/RichPushHandler.html">RichPushHandler</a></span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC31sendDeviceTokenToServerIfNeededyy10Foundation4DataVF"></a>
                    <a name="//apple_ref/swift/Method/sendDeviceTokenToServerIfNeeded(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC31sendDeviceTokenToServerIfNeededyy10Foundation4DataVF">sendDeviceTokenToServerIfNeeded(_:<wbr>)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Send the device token to a server API call.</p>

<p>This method is usually called inside the application&rsquo;s <code>didRegisterForRemoteNotificationsWithDeviceToken</code> method to get the device token.</p>

<p>The default implementation of this method
is checking if a saved device token in the Keychain is the same with the fetched token.
If the same, the method does nothing.
Otherwise, it calls <code>DevicesApi.registerDevice</code>
then saves the device token in the Keychain using <code>&quot;DeviceTokenKey&quot;</code> as key</p>
<div class="aside aside-important">
    <p class="aside-title">Important</p>
    Never send the same device token to the server.
It can be done by saving the device token somewhere (preferably the Keychain), then checking if the fetched device token
is the same with the one that was saved.

</div>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">func</span> <span class="nf">sendDeviceTokenToServerIfNeeded</span><span class="p">(</span><span class="n">_</span> <span class="nv">deviceToken</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>deviceToken</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The token of the device as <code>Data</code>.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC20requestAuthorization7options10completionySo22UNAuthorizationOptionsV_ySb_s5Error_pSgtctF"></a>
                    <a name="//apple_ref/swift/Method/requestAuthorization(options:completion:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC20requestAuthorization7options10completionySo22UNAuthorizationOptionsV_ySb_s5Error_pSgtctF">requestAuthorization(options:<wbr>completion:<wbr>)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Requests authorization to interact with the user when local and remote notifications are delivered to the user&rsquo;s device.</p>

<p>The default implementation of this method is
requesting permission to display badge, alerts, and play sounds.</p>

<p>This calls the <code>requestAuthorization(options:, completionHandler:)</code> method of the <code>UNUserNotificationCenter</code>.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">func</span> <span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="kt">UNAuthorizationOptions</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">,</span> <span class="o">.</span><span class="n">badge</span><span class="p">],</span>
                               <span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="n">_</span> <span class="nv">granted</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">,</span> <span class="n">_</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>options</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The authorization options your app is requesting.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>completion</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The closure to execute asynchronously with the results. It has no return value and has a boolean and an error object as a parameters.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>granted</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>A boolean indicating whether authorization was granted.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>error</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The error object containing error information or nil if no error occurred.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC12trackMessage2idySi_tF"></a>
                    <a name="//apple_ref/swift/Method/trackMessage(id:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC12trackMessage2idySi_tF">trackMessage(id:<wbr>)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Checks notification&rsquo;s payload for <code>message_id</code> and calls <code>MessagesAPI.trackMessage(id: id, action: .opened)</code></p>

<p>The default implementation of this method is
fetching the value of the notification&rsquo;s payload <code>&quot;message_response_id</code> key,
then calls <code>MessagesAPI.trackMessage(id:, action: .opened)</code> using the fetched value</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">func</span> <span class="nf">trackMessage</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>userInfo</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The whole notification&rsquo;s payload</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC06handleE8Response_17completionHandlerySo014UNNotificationH0C_yyctF"></a>
                    <a name="//apple_ref/swift/Method/handleNotificationResponse(_:completionHandler:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:27CheetahLoyaltyNotifications25DefaultNotificationHelperC06handleE8Response_17completionHandlerySo014UNNotificationH0C_yyctF">handleNotificationResponse(_:<wbr>completionHandler:<wbr>)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Handles Push Notification Responses</p>

<p>The default implementation of this method
is checking the <code>response.actionIdentifier</code>.
If it is <code>UNNotificationDismissActionIdentifier</code> or
if the <code>response.notification.request.content.userInfo</code> could not be casted to <code>[String: Any]</code>,
the <code>completionHandler</code> will be executed immediately.</p>

<p>Then, if an integer value for the payload&rsquo;s <code>message_response_id</code> field was found,
it calls <code>trackMessage</code>.</p>

<p>Then, if a <code><a href="../Enums/NotificationType.html">NotificationType</a></code> was not detected,
it calls <code>pushHandler.handleNotificationWithoutType</code>.</p>

<p>Then, if the <code>response.actionIdentifier</code> is <code>UNNotificationDefaultActionIdentifier</code>,
it calls <code>pushHandler.handlePush</code>, otherwise,
it calls <code>richPushHandler.handleRichPushResponse</code></p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">func</span> <span class="nf">handleNotificationResponse</span><span class="p">(</span><span class="n">_</span> <span class="nv">response</span><span class="p">:</span> <span class="kt">UNNotificationResponse</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>response</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code>UNNotificationResponse</code> based on the user&rsquo;s interaction</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>completionHandler</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>Completion block that should always be called</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://www.cheetahdigital.com/products/cheetah-loyalty" target="_blank" rel="external noopener">Cheetah Digital</a>. All rights reserved. (Last updated: 2021-10-21)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.1</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</html>
